{"ast":null,"code":"import { __decorate, __param } from 'tslib';\nimport { forwardRef, EventEmitter, Optional, Self, Inject, ChangeDetectorRef, ContentChild, ViewChild, Input, Output, TemplateRef, Component, ChangeDetectionStrategy, Directive, HostListener, NgModule } from '@angular/core';\nimport { NgControl } from '@angular/forms';\nimport { TUI_FOCUSABLE_ITEM_ACCESSOR, AbstractTuiControl, AbstractTuiNullableControl, TUI_STRICT_MATCHER, isNativeFocused, isPresent, setNativeFocused, tuiDefaultProp, tuiPure, TuiActiveZoneModule } from '@taiga-ui/cdk';\nimport { TUI_DATA_LIST_HOST, TUI_OPTION_CONTENT, TUI_DATA_LIST_ACCESSOR, TuiHostedDropdownComponent, TuiPrimitiveTextfieldComponent, TuiDataListDirective, TuiAbstractTextfieldHost, TUI_TEXTFIELD_HOST, TuiPrimitiveTextfieldModule, TuiHostedDropdownModule, TuiTextfieldComponent } from '@taiga-ui/core';\nimport { TUI_ARROW_MODE, TuiArrowModule } from '@taiga-ui/kit/components/arrow';\nimport { TUI_ITEMS_HANDLERS } from '@taiga-ui/kit/tokens';\nimport { TUI_SELECT_OPTION, TuiSelectOptionModule } from '@taiga-ui/kit/components/select-option';\nimport { FIXED_DROPDOWN_CONTROLLER_PROVIDER } from '@taiga-ui/kit/providers';\nimport { CommonModule } from '@angular/common';\nimport { PolymorpheusModule } from '@tinkoff/ng-polymorpheus'; // TODO: remove in ivy compilation\n\nimport * as ɵngcc0 from '@angular/core';\nimport * as ɵngcc1 from '@taiga-ui/core';\nimport * as ɵngcc2 from '@taiga-ui/cdk';\nimport * as ɵngcc3 from '@angular/common';\nimport * as ɵngcc4 from '@tinkoff/ng-polymorpheus';\nimport * as ɵngcc5 from '@angular/forms';\n\nfunction TuiComboBoxComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    ɵngcc0.ɵɵelement(0, \"div\", 4);\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = ɵngcc0.ɵɵnextContext();\n    ɵngcc0.ɵɵproperty(\"content\", ctx_r0.computedContent)(\"context\", ctx_r0.computeContext(ctx_r0.value, ctx_r0.computedFocused));\n  }\n}\n\nfunction TuiComboBoxComponent_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    ɵngcc0.ɵɵelement(0, \"div\", 5);\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = ɵngcc0.ɵɵnextContext();\n    ɵngcc0.ɵɵproperty(\"content\", ctx_r2.arrow);\n  }\n}\n\nconst _c0 = [\"*\", [[\"input\"]]];\nconst _c1 = [\"*\", \"input\"];\nconst COMBOBOX_OPTION = TUI_SELECT_OPTION;\nconst TUI_COMBO_BOX_PROVIDERS = [{\n  provide: TUI_FOCUSABLE_ITEM_ACCESSOR,\n  useExisting: forwardRef(() => TuiComboBoxComponent)\n}, {\n  provide: TUI_DATA_LIST_HOST,\n  useExisting: forwardRef(() => TuiComboBoxComponent)\n}, {\n  provide: AbstractTuiControl,\n  useExisting: forwardRef(() => TuiComboBoxComponent)\n}, {\n  provide: TUI_OPTION_CONTENT,\n  useValue: COMBOBOX_OPTION\n}, FIXED_DROPDOWN_CONTROLLER_PROVIDER];\nlet TuiComboBoxComponent = /*#__PURE__*/(() => {\n  let TuiComboBoxComponent = class TuiComboBoxComponent extends AbstractTuiNullableControl {\n    constructor(control, changeDetectorRef, arrowMode, itemsHandlers) {\n      super(control, changeDetectorRef);\n      this.arrowMode = arrowMode;\n      this.itemsHandlers = itemsHandlers;\n      this.stringify = this.itemsHandlers.stringify;\n      this.strictMatcher = TUI_STRICT_MATCHER;\n      this.identityMatcher = this.itemsHandlers.identityMatcher;\n      this.valueContent = '';\n      this.strict = true;\n      this.search = null;\n      this.searchChange = new EventEmitter();\n      this.datalist = '';\n      this.open = false;\n    }\n\n    get arrow() {\n      return !this.interactive ? this.arrowMode.disabled : this.arrowMode.interactive;\n    }\n\n    get nativeFocusableElement() {\n      return this.textfield ? this.textfield.nativeFocusableElement : null;\n    }\n\n    get focused() {\n      return isNativeFocused(this.nativeFocusableElement) || !!this.hostedDropdown && this.hostedDropdown.focused;\n    }\n\n    get nativeValue() {\n      return this.value === null ? this.search || '' : this.stringify(this.value);\n    }\n\n    get showValueTemplate() {\n      return isPresent(this.value) && !this.focused;\n    }\n\n    get computedContent() {\n      return this.valueContent || this.nativeValue;\n    }\n\n    computeContext($implicit, active) {\n      return {\n        $implicit,\n        active\n      };\n    }\n\n    onActiveZone(active) {\n      this.updateFocused(active);\n    }\n\n    checkOption(option) {\n      if (!this.isStrictMatch(option)) {\n        return;\n      }\n\n      this.updateValue(option);\n      this.updateSearch(null);\n    }\n\n    handleOption(item) {\n      this.setNativeValue(this.stringify(item));\n      this.focusInput();\n      this.close();\n      this.updateSearch(null);\n      this.updateValue(item);\n    }\n\n    onFieldKeyDownEnter(event) {\n      var _a;\n\n      if (this.open) {\n        event.preventDefault();\n      }\n\n      const options = ((_a = this.accessor) === null || _a === void 0 ? void 0 : _a.getOptions()) || [];\n\n      if (options.length !== 1) {\n        return;\n      }\n\n      this.updateValue(options[0]);\n      this.updateSearch(null);\n      this.close();\n    }\n\n    onValueChange(value) {\n      var _a, _b;\n\n      this.updateSearch(value);\n      const match = (_a = this.accessor) === null || _a === void 0 ? void 0 : _a.getOptions().find(item => this.isStrictMatch(item));\n\n      if (match !== undefined) {\n        this.updateValue(match);\n        this.updateSearch(null);\n        return;\n      }\n\n      if (this.strict || this.search === '') {\n        this.updateValue(null);\n      }\n\n      (_b = this.hostedDropdown) === null || _b === void 0 ? void 0 : _b.updateOpen(true);\n    }\n\n    updateValue(value) {\n      super.updateValue(value);\n    }\n\n    onHovered(hovered) {\n      this.updateHovered(hovered);\n    }\n\n    toggle() {\n      var _a;\n\n      (_a = this.hostedDropdown) === null || _a === void 0 ? void 0 : _a.updateOpen(!this.open);\n    }\n\n    isStrictMatch(item) {\n      return this.strictMatcher(item, this.search || '', this.stringify);\n    }\n\n    close() {\n      var _a;\n\n      (_a = this.hostedDropdown) === null || _a === void 0 ? void 0 : _a.updateOpen(false);\n    }\n\n    updateSearch(search) {\n      if (this.search === search) {\n        return;\n      }\n\n      this.search = search;\n      this.searchChange.emit(search);\n    }\n\n    setNativeValue(value) {\n      if (this.nativeFocusableElement) {\n        this.nativeFocusableElement.value = value;\n      }\n    }\n\n    focusInput(preventScroll = false) {\n      if (this.nativeFocusableElement) {\n        setNativeFocused(this.nativeFocusableElement, true, preventScroll);\n      }\n    }\n\n  };\n\n  TuiComboBoxComponent.ɵfac = function TuiComboBoxComponent_Factory(t) {\n    return new (t || TuiComboBoxComponent)(ɵngcc0.ɵɵdirectiveInject(NgControl, 10), ɵngcc0.ɵɵdirectiveInject(ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(TUI_ARROW_MODE), ɵngcc0.ɵɵdirectiveInject(TUI_ITEMS_HANDLERS));\n  };\n\n  TuiComboBoxComponent.ɵcmp = /*@__PURE__*/ɵngcc0.ɵɵdefineComponent({\n    type: TuiComboBoxComponent,\n    selectors: [[\"tui-combo-box\"]],\n    contentQueries: function TuiComboBoxComponent_ContentQueries(rf, ctx, dirIndex) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵcontentQuery(dirIndex, TuiDataListDirective, 5, TemplateRef);\n        ɵngcc0.ɵɵcontentQuery(dirIndex, TUI_DATA_LIST_ACCESSOR, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.datalist = _t.first);\n        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.accessor = _t.first);\n      }\n    },\n    viewQuery: function TuiComboBoxComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵviewQuery(TuiHostedDropdownComponent, 5);\n        ɵngcc0.ɵɵviewQuery(TuiPrimitiveTextfieldComponent, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.hostedDropdown = _t.first);\n        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.textfield = _t.first);\n      }\n    },\n    inputs: {\n      stringify: \"stringify\",\n      strictMatcher: \"strictMatcher\",\n      identityMatcher: \"identityMatcher\",\n      valueContent: \"valueContent\",\n      strict: \"strict\",\n      search: \"search\"\n    },\n    outputs: {\n      searchChange: \"searchChange\"\n    },\n    features: [ɵngcc0.ɵɵProvidersFeature(TUI_COMBO_BOX_PROVIDERS), ɵngcc0.ɵɵInheritDefinitionFeature],\n    ngContentSelectors: _c1,\n    decls: 7,\n    vars: 13,\n    consts: [[1, \"hosted\", 3, \"canOpen\", \"content\", \"open\", \"openChange\", \"tuiActiveZoneChange\"], [\"automation-id\", \"tui-combo-box__textfield\", 1, \"textfield\", 3, \"pseudoFocused\", \"pseudoHovered\", \"invalid\", \"nativeId\", \"readOnly\", \"iconContent\", \"disabled\", \"focusable\", \"value\", \"valueChange\", \"hoveredChange\", \"click\", \"keydown.enter\"], [\"polymorpheus-outlet\", \"\", \"automation-id\", \"tui-combo-box__template\", \"class\", \"value\", 3, \"content\", \"context\", 4, \"ngIf\"], [\"icon\", \"\"], [\"polymorpheus-outlet\", \"\", \"automation-id\", \"tui-combo-box__template\", 1, \"value\", 3, \"content\", \"context\"], [\"polymorpheus-outlet\", \"\", 1, \"t-icon\", 3, \"content\"]],\n    template: function TuiComboBoxComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵprojectionDef(_c0);\n        ɵngcc0.ɵɵelementStart(0, \"tui-hosted-dropdown\", 0);\n        ɵngcc0.ɵɵlistener(\"openChange\", function TuiComboBoxComponent_Template_tui_hosted_dropdown_openChange_0_listener($event) {\n          return ctx.open = $event;\n        })(\"tuiActiveZoneChange\", function TuiComboBoxComponent_Template_tui_hosted_dropdown_tuiActiveZoneChange_0_listener($event) {\n          return ctx.onActiveZone($event);\n        });\n        ɵngcc0.ɵɵelementStart(1, \"tui-primitive-textfield\", 1);\n        ɵngcc0.ɵɵlistener(\"valueChange\", function TuiComboBoxComponent_Template_tui_primitive_textfield_valueChange_1_listener($event) {\n          return ctx.onValueChange($event);\n        })(\"hoveredChange\", function TuiComboBoxComponent_Template_tui_primitive_textfield_hoveredChange_1_listener($event) {\n          return ctx.onHovered($event);\n        })(\"click\", function TuiComboBoxComponent_Template_tui_primitive_textfield_click_1_listener() {\n          return ctx.toggle();\n        })(\"keydown.enter\", function TuiComboBoxComponent_Template_tui_primitive_textfield_keydown_enter_1_listener($event) {\n          return ctx.onFieldKeyDownEnter($event);\n        });\n        ɵngcc0.ɵɵprojection(2);\n        ɵngcc0.ɵɵprojection(3, 1, [\"ngProjectAs\", \"input\", 5, [\"input\"]]);\n        ɵngcc0.ɵɵtemplate(4, TuiComboBoxComponent_div_4_Template, 1, 2, \"div\", 2);\n        ɵngcc0.ɵɵelementEnd();\n        ɵngcc0.ɵɵtemplate(5, TuiComboBoxComponent_ng_template_5_Template, 1, 1, \"ng-template\", null, 3, ɵngcc0.ɵɵtemplateRefExtractor);\n        ɵngcc0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        const _r1 = ɵngcc0.ɵɵreference(6);\n\n        ɵngcc0.ɵɵproperty(\"canOpen\", ctx.interactive)(\"content\", ctx.datalist || \"\")(\"open\", ctx.open);\n        ɵngcc0.ɵɵadvance(1);\n        ɵngcc0.ɵɵproperty(\"pseudoFocused\", ctx.computedFocused)(\"pseudoHovered\", ctx.computedHovered)(\"invalid\", ctx.computedInvalid)(\"nativeId\", ctx.nativeId)(\"readOnly\", ctx.readOnly)(\"iconContent\", _r1)(\"disabled\", ctx.computedDisabled)(\"focusable\", ctx.computedFocusable)(\"value\", ctx.nativeValue);\n        ɵngcc0.ɵɵadvance(3);\n        ɵngcc0.ɵɵproperty(\"ngIf\", ctx.showValueTemplate);\n      }\n    },\n    directives: [ɵngcc1.TuiHostedDropdownComponent, ɵngcc2.TuiActiveZoneDirective, ɵngcc1.TuiPrimitiveTextfieldComponent, ɵngcc1.TuiPrimitiveTextfieldDirective, ɵngcc3.NgIf, ɵngcc4.PolymorpheusOutletComponent],\n    styles: [\"[_nghost-%COMP%]{display:block;border-radius:var(--tui-radius-m);text-align:left}.hosted[_ngcontent-%COMP%]{display:block;border-radius:inherit}.textfield[_ngcontent-%COMP%]{border-radius:inherit;text-align:inherit}.value[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center}.t-icon[_ngcontent-%COMP%]{pointer-events:auto}\"],\n    changeDetection: 0\n  });\n\n  __decorate([ContentChild(TUI_DATA_LIST_ACCESSOR)], TuiComboBoxComponent.prototype, \"accessor\", void 0);\n\n  __decorate([ViewChild(TuiHostedDropdownComponent)], TuiComboBoxComponent.prototype, \"hostedDropdown\", void 0);\n\n  __decorate([ViewChild(TuiPrimitiveTextfieldComponent)], TuiComboBoxComponent.prototype, \"textfield\", void 0);\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxComponent.prototype, \"stringify\", void 0);\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxComponent.prototype, \"strictMatcher\", void 0);\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxComponent.prototype, \"identityMatcher\", void 0);\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxComponent.prototype, \"valueContent\", void 0);\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxComponent.prototype, \"strict\", void 0);\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxComponent.prototype, \"search\", void 0);\n\n  __decorate([Output()], TuiComboBoxComponent.prototype, \"searchChange\", void 0);\n\n  __decorate([ContentChild(TuiDataListDirective, {\n    read: TemplateRef\n  })], TuiComboBoxComponent.prototype, \"datalist\", void 0);\n\n  __decorate([tuiPure], TuiComboBoxComponent.prototype, \"computeContext\", null);\n\n  TuiComboBoxComponent = __decorate([__param(0, Optional()), __param(0, Self()), __param(0, Inject(NgControl)), __param(1, Inject(ChangeDetectorRef)), __param(2, Inject(TUI_ARROW_MODE)), __param(3, Inject(TUI_ITEMS_HANDLERS))], TuiComboBoxComponent);\n  return TuiComboBoxComponent;\n})();\nvar TuiComboBoxDirective_1;\nlet TuiComboBoxDirective = TuiComboBoxDirective_1 = class TuiComboBoxDirective extends TuiAbstractTextfieldHost {\n  get value() {\n    return this.host.nativeValue;\n  }\n\n  onValueChange(value) {\n    this.host.onValueChange(value);\n  }\n\n};\n\nTuiComboBoxDirective.ɵfac = /*@__PURE__*/function () {\n  let ɵTuiComboBoxDirective_BaseFactory;\n  return function TuiComboBoxDirective_Factory(t) {\n    return (ɵTuiComboBoxDirective_BaseFactory || (ɵTuiComboBoxDirective_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(TuiComboBoxDirective)))(t || TuiComboBoxDirective);\n  };\n}();\n\nTuiComboBoxDirective.ɵdir = /*@__PURE__*/ɵngcc0.ɵɵdefineDirective({\n  type: TuiComboBoxDirective,\n  selectors: [[\"tui-combo-box\"]],\n  features: [ɵngcc0.ɵɵProvidersFeature([{\n    provide: TUI_TEXTFIELD_HOST,\n    useExisting: forwardRef(() => TuiComboBoxDirective_1)\n  }]), ɵngcc0.ɵɵInheritDefinitionFeature]\n});\nlet TuiComboBoxStrictDirective = /*#__PURE__*/(() => {\n  let TuiComboBoxStrictDirective = class TuiComboBoxStrictDirective {\n    constructor(comboBox) {\n      this.comboBox = comboBox;\n      this.strict = true;\n    }\n\n    onInput() {\n      this.comboBox.updateValue(this.strict || this.comboBox.search === '' ? null : this.comboBox.search);\n    }\n\n  };\n\n  TuiComboBoxStrictDirective.ɵfac = function TuiComboBoxStrictDirective_Factory(t) {\n    return new (t || TuiComboBoxStrictDirective)(ɵngcc0.ɵɵdirectiveInject(TuiComboBoxComponent));\n  };\n\n  TuiComboBoxStrictDirective.ɵdir = /*@__PURE__*/ɵngcc0.ɵɵdefineDirective({\n    type: TuiComboBoxStrictDirective,\n    selectors: [[\"tui-combo-box\", \"strict\", \"\"]],\n    hostBindings: function TuiComboBoxStrictDirective_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵlistener(\"input\", function TuiComboBoxStrictDirective_input_HostBindingHandler() {\n          return ctx.onInput();\n        });\n      }\n    },\n    inputs: {\n      strict: \"strict\"\n    }\n  });\n\n  __decorate([Input(), tuiDefaultProp()], TuiComboBoxStrictDirective.prototype, \"strict\", void 0);\n\n  __decorate([HostListener('input')], TuiComboBoxStrictDirective.prototype, \"onInput\", null);\n\n  TuiComboBoxStrictDirective = __decorate([__param(0, Inject(TuiComboBoxComponent))], TuiComboBoxStrictDirective);\n  return TuiComboBoxStrictDirective;\n})();\nlet TuiComboBoxModule = /*#__PURE__*/(() => {\n  let TuiComboBoxModule = class TuiComboBoxModule {};\n\n  TuiComboBoxModule.ɵfac = function TuiComboBoxModule_Factory(t) {\n    return new (t || TuiComboBoxModule)();\n  };\n\n  TuiComboBoxModule.ɵmod = /*@__PURE__*/ɵngcc0.ɵɵdefineNgModule({\n    type: TuiComboBoxModule\n  });\n  TuiComboBoxModule.ɵinj = /*@__PURE__*/ɵngcc0.ɵɵdefineInjector({\n    imports: [[CommonModule, PolymorpheusModule, TuiActiveZoneModule, TuiPrimitiveTextfieldModule, TuiHostedDropdownModule, TuiSelectOptionModule, TuiArrowModule]]\n  });\n  return TuiComboBoxModule;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n(function () {\n  (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(TuiComboBoxModule, {\n    declarations: function () {\n      return [TuiComboBoxComponent, TuiComboBoxStrictDirective, TuiComboBoxDirective];\n    },\n    imports: function () {\n      return [CommonModule, PolymorpheusModule, TuiActiveZoneModule, TuiPrimitiveTextfieldModule, TuiHostedDropdownModule, TuiSelectOptionModule, TuiArrowModule];\n    },\n    exports: function () {\n      return [TuiComboBoxComponent, TuiComboBoxStrictDirective, TuiComboBoxDirective, TuiTextfieldComponent];\n    }\n  });\n})();\n/**\n * Generated bundle index. Do not edit.\n */\n\n\nexport { COMBOBOX_OPTION, TUI_COMBO_BOX_PROVIDERS, TuiComboBoxComponent, TuiComboBoxDirective, TuiComboBoxModule, TuiComboBoxStrictDirective }; //# sourceMappingURL=taiga-ui-kit-components-combo-box.js.map","map":null,"metadata":{},"sourceType":"module"}