{"ast":null,"code":"import { map, switchMap, take } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/room.service\";\nimport * as i3 from \"src/app/services/project-file-manager.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"ng2-pdf-viewer\";\nconst _c0 = [\"input\"];\n\nfunction TaskDetailsComponent_div_0_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6)(1, \"div\", 7);\n    i0.ɵɵtext(2, \"\\u0422\\u0435\\u043A\\u0443\\u0449\\u0430\\u044F \\u043E\\u0446\\u0435\\u043D\\u043A\\u0430\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 8);\n    i0.ɵɵtext(4, \"85/10\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction TaskDetailsComponent_div_0_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9);\n    i0.ɵɵelement(1, \"div\", 10);\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction TaskDetailsComponent_div_0_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 12);\n    i0.ɵɵtext(2, \"\\u0420\\u0435\\u0434\\u0430\\u043A\\u0442\\u0438\\u0440\\u043E\\u0432\\u0430\\u0442\\u044C\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 13);\n    i0.ɵɵtext(4, \"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\");\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction TaskDetailsComponent_div_0_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\")(1, \"label\", 14);\n    i0.ɵɵtext(2, \"Choose File\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 15, 16);\n    i0.ɵɵlistener(\"change\", function TaskDetailsComponent_div_0_div_8_Template_input_change_3_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.uploadWork($event.target);\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\n\nfunction TaskDetailsComponent_div_0_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"pdf-viewer\", 17);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r6 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", ctx_r6.pdfSrc)(\"render-text\", true)(\"original-size\", false);\n  }\n}\n\nfunction TaskDetailsComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"h1\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 1);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, TaskDetailsComponent_div_0_div_5_Template, 5, 0, \"div\", 2);\n    i0.ɵɵtemplate(6, TaskDetailsComponent_div_0_div_6_Template, 2, 0, \"div\", 3);\n    i0.ɵɵtemplate(7, TaskDetailsComponent_div_0_div_7_Template, 5, 0, \"div\", 4);\n    i0.ɵɵtemplate(8, TaskDetailsComponent_div_0_div_8_Template, 5, 0, \"div\", 0);\n    i0.ɵɵtemplate(9, TaskDetailsComponent_div_0_div_9_Template, 2, 3, \"div\", 5);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const task_r1 = ctx.ngIf;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\\u0417\\u0430\\u0434\\u0430\\u043D\\u0438\\u0435 \", ctx_r0.projectIndex, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(task_r1.title);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.project.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.project.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.project.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.project.length);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.project);\n  }\n}\n\nexport let TaskDetailsComponent = /*#__PURE__*/(() => {\n  class TaskDetailsComponent {\n    constructor(_activatedRouter, _roomService, _fileManager) {\n      this._activatedRouter = _activatedRouter;\n      this._roomService = _roomService;\n      this._fileManager = _fileManager; //решение студента\n\n      this.project = []; //результат ключей по которым наши вложения сохраняются на бэке\n\n      this.fileBackendKey = [];\n    }\n\n    ngOnInit() {\n      this._activatedRouter.parent.params.subscribe(id => {\n        this.roomId = id['id'];\n        this.taskId = this._activatedRouter.snapshot.paramMap['params']['id'];\n      });\n\n      this._activatedRouter.queryParamMap.pipe(map(params => params.get('index'))).subscribe(index => {\n        this.projectIndex = index;\n      });\n\n      this.task$ = this._roomService.getTaskById(this.taskId);\n\n      this._fileManager.getSelfProjectByTaskId(this.taskId).subscribe({\n        next: data => {\n          this.project = data;\n\n          if (data) {\n            this.openWork(data[0].attachments[0]);\n          }\n        }\n      });\n    }\n\n    uploadWork(element) {\n      const fileToUpload = element.files.item(0);\n\n      this._fileManager.uploadStudentWork(fileToUpload).pipe(switchMap(data => {\n        return this._fileManager.createProject(this.taskId, data);\n      })).subscribe();\n    }\n\n    openWork(fileName) {\n      this._fileManager.openFile(fileName).pipe(take(1)).subscribe({\n        next: data => {\n          let blob = new Blob([data], {\n            type: 'application/pdf'\n          });\n          let url = window.URL.createObjectURL(blob);\n          this.pdfSrc = url;\n        }\n      });\n    }\n\n  }\n\n  TaskDetailsComponent.ɵfac = function TaskDetailsComponent_Factory(t) {\n    return new (t || TaskDetailsComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.RoomService), i0.ɵɵdirectiveInject(i3.ProjectFileManagerService));\n  };\n\n  TaskDetailsComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TaskDetailsComponent,\n    selectors: [[\"ng-component\"]],\n    viewQuery: function TaskDetailsComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n\n      if (rf & 2) {\n        let _t;\n\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.input = _t.first);\n      }\n    },\n    decls: 2,\n    vars: 3,\n    consts: [[4, \"ngIf\"], [1, \"title\"], [\"class\", \"grade\", 4, \"ngIf\"], [\"class\", \"scale\", 4, \"ngIf\"], [\"class\", \"actions\", 4, \"ngIf\"], [4, \"ngFor\", \"ngForOf\"], [1, \"grade\"], [1, \"grade__current\"], [1, \"grade__percent\"], [1, \"scale\"], [1, \"scale__linear\"], [1, \"actions\"], [1, \"actions__edit\"], [1, \"actions__delete\"], [\"for\", \"file\"], [\"id\", \"file\", \"accept\", \"application/pdf\", \"type\", \"file\", 3, \"change\"], [\"input\", \"\"], [2, \"width\", \"780px\", \"height\", \"500px\", \"box-shadow\", \"0px 0px 15px rgba(0, 0, 0, 0.1)\", 3, \"src\", \"render-text\", \"original-size\"]],\n    template: function TaskDetailsComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, TaskDetailsComponent_div_0_Template, 10, 7, \"div\", 0);\n        i0.ɵɵpipe(1, \"async\");\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.task$));\n      }\n    },\n    directives: [i4.NgIf, i4.NgForOf, i5.PdfViewerComponent],\n    pipes: [i4.AsyncPipe],\n    styles: [\"h1[_ngcontent-%COMP%]{font-size:80px}.upload[_ngcontent-%COMP%]{font-size:24px;color:#7256fd;font-weight:700;cursor:pointer}.title[_ngcontent-%COMP%]{font-size:24px;margin-bottom:20px}.actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.actions__edit[_ngcontent-%COMP%]{color:#7256fd;font-size:24px;font-weight:700}.actions__delete[_ngcontent-%COMP%]{color:#fe5151;font-weight:700;font-size:24px}.grade[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:-23px}.grade__current[_ngcontent-%COMP%]{font-size:18px}.scale[_ngcontent-%COMP%]{width:100%;height:20px;background:#FFFFFF;box-shadow:0 0 15px #0000001a;margin-bottom:40px}.scale__linear[_ngcontent-%COMP%]{width:85%;height:100%;background-color:#17f5b3}\"]\n  });\n  return TaskDetailsComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}